<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}CyberGuard - {{ title or "Dashboard" }}{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Minimal extras to support the auth pages */
    .auth-shell {
      min-height: calc(100vh - 64px);
      display: grid;
      place-items: center;
      padding: 28px 18px;
      background:
        radial-gradient(900px 500px at -10% 0%, rgba(118,75,162,0.08), transparent 60%),
        radial-gradient(900px 500px at 120% 20%, rgba(102,126,234,0.08), transparent 60%),
        linear-gradient(180deg, #ffffff, #f7f9ff);
    }
    .auth-wrap {
      width: 100%;
      max-width: 1040px;
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 18px;
    }
    @media (max-width: 980px) {
      .auth-wrap { grid-template-columns: 1fr; }
    }
    .auth-panel {
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(102,126,234,0.15);
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(20,20,40,0.10);
      overflow: hidden;
    }
    .auth-illustration {
      position: relative;
      padding: 26px;
      display: grid;
      gap: 14px;
      align-content: center;
      min-height: 420px;
      background:
        linear-gradient(135deg, #667eea 0%, #764ba2 35%, #ff6b9d 100%);
      color: #fff;
    }
    .auth-illustration .big {
      font-size: 34px; font-weight: 900; line-height: 1.15; margin: 0;
    }
    .auth-illustration p {
      margin: 6px 0 0; opacity: .95; max-width: 520px;
      font-size: 15.5px;
    }
    .auth-ill-bullets { margin: 8px 0 0; padding-left: 18px; }
    .auth-ill-bullets li { margin: 6px 0; }

    .auth-content { padding: 26px 22px; }
    .auth-title { margin: 0 0 6px; font-weight: 900; font-size: 26px; color: #1f2140; }
    .auth-sub { margin: 0 0 10px; color: #4b4f69; }
    .auth-form .row { margin-bottom: 12px; }
    .auth-form label { display:block; font-weight: 700; color: #2d2a4a; margin-bottom: 6px; }
    .auth-input, .auth-select {
      width: 100%; padding: 12px 12px; border-radius: 12px;
      border: 1px solid #e3e8f5; background: #fff; outline: none;
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    .auth-input:focus, .auth-select:focus {
      border-color: #c7d2fe; box-shadow: 0 0 0 4px rgba(102,126,234,.15);
    }
    .auth-actions { display:flex; gap:10px; align-items:center; margin-top: 8px; }
    .btn-wide { padding: 14px 18px; font-size: 15px; border-radius: 12px; }
    .muted-line { font-size: 13px; color: #5a5f7a; }
    .policy { font-size: 13px; color: #444; margin-top: 4px; }

    /* Make main truly full-width when no sidebar (home/login/register) */
    .main.main--full { max-width: none; margin: 0; }
  </style>
</head>
<body class="{% if request.endpoint == 'home' %}no-sidebar{% endif %}">
  <!-- Topbar -->
  <div class="topbar">
    <a class="brand brand-link" href="{{ url_for('home') }}">CyberGuard</a>

    <div class="top-actions">
      {% if current_user.is_authenticated %}
        <span class="user">Hi, {{ current_user.fullname or current_user.email }}</span>
        <a class="btn" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
      {% else %}
        {% if request.endpoint != 'home' %}
          <a class="btn" href="{{ url_for('login') }}"><i class="fas fa-right-to-bracket"></i> Sign In</a>
          <a class="btn" href="{{ url_for('register') }}"><i class="fas fa-user-plus"></i> Create Account</a>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <div class="container">
    {# Sidebar hidden on home/login/register #}
    {% if current_user.is_authenticated and request.endpoint not in ['home','login','register'] %}
      <aside class="sidebar">
        <nav>
          <a href="{{ url_for('dashboard') }}" class="{{ 'active' if request.endpoint == 'dashboard' else '' }}">Overview</a>
          <a href="{{ url_for('detect') }}" class="{{ 'active' if request.endpoint == 'detect' else '' }}">Threat Detection</a>

          {% if current_user.role in ['admin','superadmin'] %}
            <a href="{{ url_for('admin_users') }}" class="{{ 'active' if request.endpoint in ['admin_users','approve','reject'] else '' }}">Manage Users</a>
            <a href="{{ url_for('admin_train') }}" class="{{ 'active' if request.endpoint == 'admin_train' else '' }}">Train Model</a>
            {% if has_admin_models %}
              <a href="{{ url_for('admin_models') }}" class="{{ 'active' if request.endpoint == 'admin_models' else '' }}">Models</a>
            {% endif %}
          {% endif %}
        </nav>
        <div class="sidebar-note">Secure. Fast. Insightful.</div>
      </aside>
    {% endif %}

    <main class="main{% if not current_user.is_authenticated or request.endpoint == 'home' %} main--full{% endif %}">
      <div class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flashboxes">
              {% for cat, msg in messages %}
                <div class="flash {{ cat }}">{{ msg }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
