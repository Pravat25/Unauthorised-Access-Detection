{% extends "base.html" %}
{% block content %}
<section class="page-hero">
  <h1 class="page-title">Train a Model</h1>
  <p class="page-subtitle">
    Upload a labeled CSV and choose an algorithm. We’ll automatically <strong>trim to 10,000 rows (stratified by label)</strong> for speed and balance,
    one-hot encode categoricals, and show test accuracy.
  </p>
</section>

<div class="detect-layout">
  <!-- LEFT: Training form -->
  <div class="panel glass">
    <div class="panel-header">
      <i class="fas fa-robot"></i>
      <h2 class="panel-title">Start Training</h2>
    </div>

    <form method="post" action="{{ url_for('admin_train') }}" enctype="multipart/form-data" class="fancy-form">
       <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="form-row">
        <label>Model Type</label>
        <select name="model_type" class="input select" required>
          {% for m in models %}
            <option value="{{ m }}" {% if preselected==m %}selected{% endif %}>
              {{ m|replace('-', ' ')|title }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row">
        <label>Training CSV</label>
        <div class="filebox" id="filebox-train">
          <input id="trainfile" name="trainfile" type="file" accept=".csv" required>
          <label for="trainfile">
            <i class="fas fa-cloud-upload-alt"></i>
            <span class="filebox-title">Drag & drop or click to upload</span>
            <span class="filebox-sub">CSV only • Must include a <code>label</code>/<code>target</code> column or last column as label</span>
            <span class="filebox-name" id="trainFileName">No file selected</span>
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn btn-cta btn-lg" type="submit">
          <i class="fas fa-rocket"></i> Start Training
        </button>
      </div>

      <div class="train-notes">
        <div class="note success"><i class="fas fa-balance-scale-left"></i> Stratified trim to <strong>10,000</strong> rows preserves class balance.</div>
        <div class="note info"><i class="fas fa-layer-group"></i> Categorical features are one-hot encoded automatically.</div>
        <div class="note warn"><i class="fas fa-exclamation-triangle"></i> Very wide CSVs may be slow after encoding; consider pruning unused columns.</div>
      </div>
    </form>
  </div>

  <!-- RIGHT: Tips / Checklist -->
  <aside class="panel tips">
    <div class="panel-header">
      <i class="fas fa-clipboard-check"></i>
      <h3 class="panel-title">Training Checklist</h3>
    </div>
    <ul class="step-list">
      <li><span class="badge">1</span> Include a <code>label</code> / <code>target</code> column (or ensure last column is the class).</li>
      <li><span class="badge">2</span> Remove obvious IDs or leaky columns (e.g., timestamps of the future).</li>
      <li><span class="badge">3</span> Keep column names consistent between training and detection CSVs.</li>
      <li><span class="badge">4</span> Prefer balanced datasets; the trim step helps, but starting balanced is best.</li>
    </ul>

    <div class="panel-sub">
      <h4 class="mini-title"><i class="fas fa-info-circle"></i> What you’ll get</h4>
      <ul class="tip-list">
        <li><i class="fas fa-check"></i> Saved model artifact (<code>.pkl</code>)</li>
        <li><i class="fas fa-check"></i> Test accuracy (visible in flash + Models page)</li>
        <li><i class="fas fa-check"></i> Confusion matrix image (under <code>static/img/</code>)</li>
      </ul>
    </div>
  </aside>
</div>

<script>
  // Show chosen file name + drag state
  (function () {
    const input = document.getElementById('trainfile');
    const nameOut = document.getElementById('trainFileName');
    if (input && nameOut) {
      input.addEventListener('change', function () {
        nameOut.textContent = this.files && this.files[0] ? this.files[0].name : 'No file selected';
      });
    }
    const box = document.getElementById('filebox-train');
    if (box) {
      ['dragenter','dragover'].forEach(ev => box.addEventListener(ev, e => {
        e.preventDefault(); box.classList.add('dragging');
      }));
      ['dragleave','drop'].forEach(ev => box.addEventListener(ev, e => {
        e.preventDefault(); box.classList.remove('dragging');
      }));
    }
  })();
</script>
{% endblock %}
